version: "3.9"

services:
  golang:
    build:
      dockerfile: .Dockerfile.go.dev
      context: .
    user: "${USER}"
    volumes:
      - ./:/air/code
    links:
      - redis
    environment:
      - DNDMACHINE_DSN=sqlite:///air/machine.db
      - DNDMACHINE_REDIS_ADDRESS=redis:6379

  react:
    build:
      dockerfile: .Dockerfile.react.dev
      context: .
    user: "${USER}"
    ports:
      - "3000:3000"
    volumes:
      - ./ui/package.json:/app/package.json
      - ./ui/package-lock.json:/app/package-lock.json
      - ./ui/public:/app/public
      - ./ui/src:/app/src

  redis:
    image: redis:alpine
